process CreateKey = {
    include "FWCore/MessageLogger/data/MessageLogger.cfi"
    untracked PSet maxEvents = { untracked int32 input = 10 }

    source = EmptyIOVSource {
        string timetype = "runnumber"
        untracked uint32 firstRun = 1
        untracked uint32 lastRun = 10
        uint32 interval = 1
    }

    # Empty record sources. This is used to make sure that the data is put in EventSetup for L1TWriter
    # to read it from there
    es_source a = EmptyESSource {
        string recordName = "L1CSCTPParametersRcd"
        vuint32 firstValid = { 1 }
        bool iovIsRunNotTime = true
    }

    es_source b = EmptyESSource {
        string recordName = "L1EmEtScaleRcd"
        vuint32 firstValid = { 1 }
        bool iovIsRunNotTime = true
    }

    es_source c = EmptyESSource {
        string recordName = "L1JetEtScaleRcd"
        vuint32 firstValid = { 1 }
        bool iovIsRunNotTime = true
    }

    include "CondCore/DBCommon/data/CondDBCommon.cfi"
    replace CondDBCommon.connect = "sqlite_file:test.db"
    replace CondDBCommon.catalog = "file:test.xml"

    # create data
    # L1TWriter writes data from EventSetup to pool db. Those to lines will register
    # es_modules that will create ojects that I am interested to save.
    # L1TriggerKey is special object - L1TWriter will create it itself.
    include "L1TriggerConfig/L1CSCTPConfigProducers/data/L1CSCTriggerPrimitivesConfig.cfi"
    include "L1TriggerConfig/L1ScalesProducers/data/l1CaloScales.cfi"

    # enable saver
    # Module can be run several times provided that the following conditions are met
    # * No sinceRun is provided - illogical to save data for the same IOV several times
    # * No keyValue provided - we cann't store different IOV intervals with the same keyValue, so use generated one
    module save = L1TWriter {
        string connect = "sqlite_file:test.db"          # Database to use. Same as in PoolDBOutputService
        string catalog = "file:test.xml"                # Catalog to use. Same as in PoolDBOutputService, but only valid catalogs
                                                        # accepted, no fancy "local" or other shortcuts.

        string keyTag = "current"                       # Tag to use for the key. Recuired

#        int32 sinceRun = 10                              # Determins what run assign as start of validity interval.
                                                        # Optional, if missing use one from EventSetup

        VPSet toSave = { {                              # Optional, but not much point to skip it.
            string record = "L1CSCTPParametersRcd"      # Records to process
            vstring data = {"L1CSCTPParameters"}        # Values from record to save
        },
        {
            string record = "L1EmEtScaleRcd"
            vstring data = {"L1CaloEtScale"}
        },
        {
            string record = "L1JetEtScaleRcd"
            vstring data = {"L1CaloEtScale"}
        }
        }
    }

    module check = EventSetupRecordDataGetter {
        VPSet toGet = { {
            string record = "L1CSCTPParametersRcd"
            vstring data = {"L1CSCTPParameters"}
        } }
        untracked bool verbose = true
    }

    path p = { check, save }
}
